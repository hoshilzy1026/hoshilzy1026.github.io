<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-m.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-m.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hoshilzy1026.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="raftæ˜¯å·¥ç¨‹ä¸Šä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„å¼ºä¸€è‡´æ€§ã€å»ä¸­å¿ƒåŒ–ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼åè®®ã€‚åœ¨è¿™é‡Œå¼ºè°ƒäº†æ˜¯åœ¨å·¥ç¨‹ä¸Šï¼Œå› ä¸ºåœ¨å­¦æœ¯ç†è®ºç•Œï¼Œæœ€è€€çœ¼çš„è¿˜æ˜¯å¤§åé¼é¼çš„Paxosã€‚ä½†Paxosæ˜¯ï¼šå°‘æ•°çœŸæ­£ç†è§£çš„äººè§‰å¾—ç®€å•ï¼Œå°šæœªç†è§£çš„äººè§‰å¾—å¾ˆéš¾ï¼Œå¤§å¤šæ•°äººéƒ½æ˜¯ä¸€çŸ¥åŠè§£ã€‚æœ¬äººä¹ŸèŠ±äº†å¾ˆå¤šæ—¶é—´ã€çœ‹äº†å¾ˆå¤šææ–™ä¹Ÿæ²¡æœ‰çœŸæ­£ç†è§£ã€‚ç›´åˆ°çœ‹åˆ°raftçš„è®ºæ–‡ï¼Œä¸¤ä½ç ”ç©¶è€…ä¹Ÿæåˆ°ï¼Œä»–ä»¬ä¹ŸèŠ±äº†å¾ˆé•¿çš„æ—¶é—´æ¥ç†è§£Paxosï¼Œä»–ä»¬ä¹Ÿè§‰å¾—å¾ˆéš¾ç†è§£ï¼Œäºæ˜¯ç ”ç©¶å‡ºäº†ra">
<meta property="og:type" content="article">
<meta property="og:title" content="Raftç®—æ³•">
<meta property="og:url" content="https://hoshilzy1026.github.io/2023/03/13/Raft/index.html">
<meta property="og:site_name" content="Hoshi">
<meta property="og:description" content="raftæ˜¯å·¥ç¨‹ä¸Šä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„å¼ºä¸€è‡´æ€§ã€å»ä¸­å¿ƒåŒ–ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼åè®®ã€‚åœ¨è¿™é‡Œå¼ºè°ƒäº†æ˜¯åœ¨å·¥ç¨‹ä¸Šï¼Œå› ä¸ºåœ¨å­¦æœ¯ç†è®ºç•Œï¼Œæœ€è€€çœ¼çš„è¿˜æ˜¯å¤§åé¼é¼çš„Paxosã€‚ä½†Paxosæ˜¯ï¼šå°‘æ•°çœŸæ­£ç†è§£çš„äººè§‰å¾—ç®€å•ï¼Œå°šæœªç†è§£çš„äººè§‰å¾—å¾ˆéš¾ï¼Œå¤§å¤šæ•°äººéƒ½æ˜¯ä¸€çŸ¥åŠè§£ã€‚æœ¬äººä¹ŸèŠ±äº†å¾ˆå¤šæ—¶é—´ã€çœ‹äº†å¾ˆå¤šææ–™ä¹Ÿæ²¡æœ‰çœŸæ­£ç†è§£ã€‚ç›´åˆ°çœ‹åˆ°raftçš„è®ºæ–‡ï¼Œä¸¤ä½ç ”ç©¶è€…ä¹Ÿæåˆ°ï¼Œä»–ä»¬ä¹ŸèŠ±äº†å¾ˆé•¿çš„æ—¶é—´æ¥ç†è§£Paxosï¼Œä»–ä»¬ä¹Ÿè§‰å¾—å¾ˆéš¾ç†è§£ï¼Œäºæ˜¯ç ”ç©¶å‡ºäº†ra">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://arthurchiao.art/assets/img/raft-paper/4.png">
<meta property="og:image" content="https://arthurchiao.art/assets/img/raft-paper/5.png">
<meta property="og:image" content="https://i.postimg.cc/3RGMCShr/Snipaste-2025-10-13-20-38-22.png">
<meta property="og:image" content="https://i.postimg.cc/Xq6R2fNV/Snipaste-2025-10-13-20-38-59.png">
<meta property="og:image" content="https://i.postimg.cc/brf76xYy/Snipaste-2025-10-13-20-39-05.png">
<meta property="og:image" content="https://i.postimg.cc/5yWhPB99/Snipaste-2025-10-13-20-39-10.png">
<meta property="og:image" content="https://i.postimg.cc/NFv3N6GY/Snipaste-2025-10-13-20-39-14.png">
<meta property="og:image" content="https://i.postimg.cc/zvYsdCDB/Snipaste-2025-10-13-20-39-20.png">
<meta property="og:image" content="https://i.postimg.cc/vTwJPr81/Snipaste-2025-10-13-20-39-24.png">
<meta property="og:image" content="https://i.postimg.cc/brf76xYk/Snipaste-2025-10-13-20-39-28.png">
<meta property="article:published_time" content="2023-03-13T12:06:02.000Z">
<meta property="article:modified_time" content="2025-10-13T12:57:33.393Z">
<meta property="article:author" content="lzy">
<meta property="article:tag" content="åˆ†å¸ƒå¼">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://arthurchiao.art/assets/img/raft-paper/4.png">

<link rel="canonical" href="https://hoshilzy1026.github.io/2023/03/13/Raft/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Raftç®—æ³• | Hoshi</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y6XQ2TRE3Y"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Y6XQ2TRE3Y');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hoshi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hoshilzy1026.github.io/2023/03/13/Raft/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lzy">
      <meta itemprop="description" content="é€‰æ‹©æœ‰æ—¶å€™æ¯”åŠªåŠ›æ›´é‡è¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hoshi">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Raftç®—æ³•
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2023-03-13 20:06:02" itemprop="dateCreated datePublished" datetime="2023-03-13T20:06:02+08:00">2023-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-13 20:57:33" itemprop="dateModified" datetime="2025-10-13T20:57:33+08:00">2025-10-13</time>
              </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>5.5k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>20 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>â€ƒâ€ƒraftæ˜¯å·¥ç¨‹ä¸Šä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„å¼ºä¸€è‡´æ€§ã€å»ä¸­å¿ƒåŒ–ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼åè®®ã€‚åœ¨è¿™é‡Œå¼ºè°ƒäº†æ˜¯åœ¨å·¥ç¨‹ä¸Šï¼Œå› ä¸ºåœ¨å­¦æœ¯ç†è®ºç•Œï¼Œæœ€è€€çœ¼çš„è¿˜æ˜¯å¤§åé¼é¼çš„Paxosã€‚ä½†Paxosæ˜¯ï¼šå°‘æ•°çœŸæ­£ç†è§£çš„äººè§‰å¾—ç®€å•ï¼Œå°šæœªç†è§£çš„äººè§‰å¾—å¾ˆéš¾ï¼Œå¤§å¤šæ•°äººéƒ½æ˜¯ä¸€çŸ¥åŠè§£ã€‚æœ¬äººä¹ŸèŠ±äº†å¾ˆå¤šæ—¶é—´ã€çœ‹äº†å¾ˆå¤šææ–™ä¹Ÿæ²¡æœ‰çœŸæ­£ç†è§£ã€‚ç›´åˆ°çœ‹åˆ°raftçš„è®ºæ–‡ï¼Œä¸¤ä½ç ”ç©¶è€…ä¹Ÿæåˆ°ï¼Œä»–ä»¬ä¹ŸèŠ±äº†å¾ˆé•¿çš„æ—¶é—´æ¥ç†è§£Paxosï¼Œä»–ä»¬ä¹Ÿè§‰å¾—å¾ˆéš¾ç†è§£ï¼Œäºæ˜¯ç ”ç©¶å‡ºäº†raftç®—æ³•ã€‚</p>
<p>â€ƒâ€ƒ raftæ˜¯ä¸€ä¸ªå…±è¯†ç®—æ³•ï¼ˆconsensus algorithmï¼‰ï¼Œæ‰€è°“å…±è¯†ï¼Œå°±æ˜¯å¤šä¸ªèŠ‚ç‚¹å¯¹æŸä¸ªäº‹æƒ…è¾¾æˆä¸€è‡´çš„çœ‹æ³•ï¼Œå³ä½¿æ˜¯åœ¨éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œå»¶æ—¶ã€ç½‘ç»œåˆ†å‰²çš„æƒ…å†µä¸‹ã€‚è¿™äº›å¹´æœ€ä¸ºç«çƒ­çš„åŠ å¯†è´§å¸ï¼ˆæ¯”ç‰¹å¸ã€åŒºå—é“¾ï¼‰å°±éœ€è¦å…±è¯†ç®—æ³•ï¼Œè€Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå…±è¯†ç®—æ³•æ›´å¤šç”¨äºæé«˜ç³»ç»Ÿçš„å®¹é”™æ€§ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼å­˜å‚¨ä¸­çš„å¤åˆ¶é›†ï¼ˆreplicationï¼‰ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xybaby/p/7153755.html">å¸¦ç€é—®é¢˜å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹ä¸­å¿ƒåŒ–å¤åˆ¶é›†</a>ä¸€æ–‡ä¸­ä»‹ç»äº†ä¸­å¿ƒåŒ–å¤åˆ¶é›†çš„ç›¸å…³çŸ¥è¯†ã€‚raftåè®®å°±æ˜¯ä¸€ç§leader-basedçš„å…±è¯†ç®—æ³•ï¼Œä¸ä¹‹ç›¸åº”çš„æ˜¯leaderlessçš„å…±è¯†ç®—æ³•ã€‚</p>
<p>â€ƒâ€ƒæœ¬æ–‡åŸºäºè®ºæ–‡<a target="_blank" rel="noopener" href="https://web.stanford.edu/~ouster/cgi-bin/papers/raft-atc14">In Search of an Understandable Consensus Algorithm</a>å¯¹raftåè®®è¿›è¡Œåˆ†æï¼Œå½“ç„¶ï¼Œè¿˜æ˜¯å»ºè®®è¯»è€…ç›´æ¥çœ‹è®ºæ–‡ã€‚</p>
<span id="more"></span>

<h2 id="raftç®—æ³•æ¦‚è§ˆ"><a href="#raftç®—æ³•æ¦‚è§ˆ" class="headerlink" title="raftç®—æ³•æ¦‚è§ˆ"></a>raftç®—æ³•æ¦‚è§ˆ</h2><p>â€ƒâ€ƒRaftç®—æ³•çš„å¤´å·ç›®æ ‡å°±æ˜¯å®¹æ˜“ç†è§£ï¼ˆUnderStandableï¼‰ï¼Œè¿™ä»è®ºæ–‡çš„æ ‡é¢˜å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚å½“ç„¶ï¼ŒRaftå¢å¼ºäº†å¯ç†è§£æ€§ï¼Œåœ¨æ€§èƒ½ã€å¯é æ€§ã€å¯ç”¨æ€§æ–¹é¢æ˜¯ä¸è¾“äºPaxosçš„ã€‚</p>
<blockquote>
<p>Raft more understandable than Paxos and also provides a better foundation for building practical systems</p>
</blockquote>
<p>â€ƒâ€ƒ ä¸ºäº†è¾¾åˆ°æ˜“äºç†è§£çš„ç›®æ ‡ï¼Œraftåšäº†å¾ˆå¤šåŠªåŠ›ï¼Œå…¶ä¸­æœ€ä¸»è¦æ˜¯ä¸¤ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>é—®é¢˜åˆ†è§£</li>
<li>çŠ¶æ€ç®€åŒ–</li>
</ul>
<p>â€ƒâ€ƒ é—®é¢˜åˆ†è§£æ˜¯å°†â€å¤åˆ¶é›†ä¸­èŠ‚ç‚¹ä¸€è‡´æ€§â€è¿™ä¸ªå¤æ‚çš„é—®é¢˜åˆ’åˆ†ä¸ºæ•°ä¸ªå¯ä»¥è¢«ç‹¬ç«‹è§£é‡Šã€ç†è§£ã€è§£å†³çš„å­é—®é¢˜ã€‚åœ¨raftï¼Œå­é—®é¢˜åŒ…æ‹¬ï¼Œ<em>leader election</em>ï¼Œ <em>log replication</em>ï¼Œ<em>safety</em>ï¼Œ<em>membership changes</em>ã€‚è€ŒçŠ¶æ€ç®€åŒ–æ›´å¥½ç†è§£ï¼Œå°±æ˜¯å¯¹ç®—æ³•åšå‡ºä¸€äº›é™åˆ¶ï¼Œå‡å°‘éœ€è¦è€ƒè™‘çš„çŠ¶æ€æ•°ï¼Œä½¿å¾—ç®—æ³•æ›´åŠ æ¸…æ™°ï¼Œæ›´å°‘çš„ä¸ç¡®å®šæ€§ï¼ˆæ¯”å¦‚ï¼Œä¿è¯æ–°é€‰ä¸¾å‡ºæ¥çš„leaderä¼šåŒ…å«æ‰€æœ‰commited log entryï¼‰</p>
<blockquote>
<p>Raft implements consensus by first electing a distinguished leader, then giving the leader complete responsibility for managing the replicated log. The leader accepts log entries from clients, replicates them on other servers, and tells servers when it is safe to apply log entries to their state machines. A leader can fail or become disconnected from the other servers, in which case a new leader is elected.</p>
</blockquote>
<p>â€ƒâ€ƒ ä¸Šé¢çš„å¼•æ–‡å¯¹raftåè®®çš„å·¥ä½œåŸç†è¿›è¡Œäº†é«˜åº¦çš„æ¦‚æ‹¬ï¼šraftä¼šå…ˆé€‰ä¸¾å‡ºleaderï¼Œleaderå®Œå…¨è´Ÿè´£replicated logçš„ç®¡ç†ã€‚leaderè´Ÿè´£æ¥å—æ‰€æœ‰å®¢æˆ·ç«¯æ›´æ–°è¯·æ±‚ï¼Œç„¶åå¤åˆ¶åˆ°followerèŠ‚ç‚¹ï¼Œå¹¶åœ¨â€œå®‰å…¨â€çš„æ—¶å€™æ‰§è¡Œè¿™äº›è¯·æ±‚ã€‚å¦‚æœleaderæ•…éšœï¼Œfollowesä¼šé‡æ–°é€‰ä¸¾å‡ºæ–°çš„leaderã€‚</p>
<p>â€ƒâ€ƒ è¿™å°±æ¶‰åŠåˆ°raftæœ€æ–°çš„ä¸¤ä¸ªå­é—®é¢˜ï¼š leader electionå’Œlog replication</p>
<h2 id="leader-election"><a href="#leader-election" class="headerlink" title="leader election"></a>leader election</h2><p>â€ƒ raftåè®®ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä»»ä¸€æ—¶åˆ»å¤„äºä»¥ä¸‹ä¸‰ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼š</p>
<ul>
<li>leader</li>
<li>follower</li>
<li>candidate</li>
</ul>
<p>â€ƒâ€ƒ ç»™å‡ºçŠ¶æ€è½¬ç§»å›¾èƒ½å¾ˆç›´è§‚çš„ç›´åˆ°è¿™ä¸‰ä¸ªçŠ¶æ€çš„åŒºåˆ«</p>
<p><img src="https://arthurchiao.art/assets/img/raft-paper/4.png" alt="image-20251013201257243"></p>
<p>å¯ä»¥çœ‹å‡ºæ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨æ—¶éƒ½æ˜¯followerçŠ¶æ€ï¼›åœ¨ä¸€æ®µæ—¶é—´å†…å¦‚æœæ²¡æœ‰æ”¶åˆ°æ¥è‡ªleaderçš„å¿ƒè·³ï¼Œä»followeråˆ‡æ¢åˆ°candidateï¼Œå‘èµ·é€‰ä¸¾ï¼›å¦‚æœæ”¶åˆ°majorityçš„é€ æˆç¥¨ï¼ˆå«è‡ªå·±çš„ä¸€ç¥¨ï¼‰åˆ™åˆ‡æ¢åˆ°leaderçŠ¶æ€ï¼›å¦‚æœå‘ç°å…¶ä»–èŠ‚ç‚¹æ¯”è‡ªå·±æ›´æ–°ï¼Œåˆ™ä¸»åŠ¨åˆ‡æ¢åˆ°followerã€‚</p>
<p>â€ƒâ€ƒ æ€»ä¹‹ï¼Œç³»ç»Ÿä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªleaderï¼Œå¦‚æœåœ¨ä¸€æ®µæ—¶é—´é‡Œå‘ç°æ²¡æœ‰leaderï¼Œåˆ™å¤§å®¶é€šè¿‡é€‰ä¸¾-æŠ•ç¥¨é€‰å‡ºleaderã€‚leaderä¼šä¸åœçš„ç»™followerå‘å¿ƒè·³æ¶ˆæ¯ï¼Œè¡¨æ˜è‡ªå·±çš„å­˜æ´»çŠ¶æ€ã€‚å¦‚æœleaderæ•…éšœï¼Œé‚£ä¹ˆfollowerä¼šè½¬æ¢æˆcandidateï¼Œé‡æ–°é€‰å‡ºleaderã€‚</p>
<ul>
<li>term</li>
</ul>
<p> ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå“ªä¸ªèŠ‚ç‚¹åšleaderæ˜¯å¤§å®¶æŠ•ç¥¨é€‰ä¸¾å‡ºæ¥çš„ï¼Œæ¯ä¸ªleaderå·¥ä½œä¸€æ®µæ—¶é—´ï¼Œç„¶åé€‰å‡ºæ–°çš„leaderç»§ç»­è´Ÿè´£ã€‚è¿™æ ¹æ°‘ä¸»ç¤¾ä¼šçš„é€‰ä¸¾å¾ˆåƒï¼Œæ¯ä¸€å±Šæ–°çš„å±¥èŒæœŸç§°ä¹‹ä¸ºä¸€å±Šä»»æœŸï¼Œåœ¨raftåè®®ä¸­ï¼Œä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œå¯¹åº”çš„æœ¯è¯­å«<em><strong>term</strong></em>ã€‚</p>
<p><img src="https://arthurchiao.art/assets/img/raft-paper/5.png" alt="image-20251013201400338"></p>
<p> termï¼ˆä»»æœŸï¼‰ä»¥é€‰ä¸¾ï¼ˆelectionï¼‰å¼€å§‹ï¼Œç„¶åå°±æ˜¯ä¸€æ®µæˆ–é•¿æˆ–çŸ­çš„ç¨³å®šå·¥ä½œæœŸï¼ˆnormal Operationï¼‰ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œä»»æœŸæ˜¯é€’å¢çš„ï¼Œè¿™å°±å……å½“äº†é€»è¾‘æ—¶é’Ÿçš„ä½œç”¨ï¼›å¦å¤–ï¼Œterm 3å±•ç¤ºäº†ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯è¯´æ²¡æœ‰é€‰ä¸¾å‡ºleaderå°±ç»“æŸäº†ï¼Œç„¶åä¼šå‘èµ·æ–°çš„é€‰ä¸¾ï¼Œåé¢ä¼šè§£é‡Šè¿™ç§<em>split vote</em>çš„æƒ…å†µã€‚</p>
<h2 id="é€‰ä¸¾è¿‡ç¨‹è¯¦è§£"><a href="#é€‰ä¸¾è¿‡ç¨‹è¯¦è§£" class="headerlink" title="é€‰ä¸¾è¿‡ç¨‹è¯¦è§£"></a>é€‰ä¸¾è¿‡ç¨‹è¯¦è§£</h2><p>â€ƒ ä¸Šé¢å·²ç»è¯´è¿‡ï¼Œå¦‚æœfolloweråœ¨<em>election timeout</em>å†…æ²¡æœ‰æ”¶åˆ°æ¥è‡ªleaderçš„å¿ƒè·³ï¼Œï¼ˆä¹Ÿè®¸æ­¤æ—¶è¿˜æ²¡æœ‰é€‰å‡ºleaderï¼Œå¤§å®¶éƒ½åœ¨ç­‰ï¼›ä¹Ÿè®¸leaderæŒ‚äº†ï¼›ä¹Ÿè®¸åªæ˜¯leaderä¸è¯¥followerä¹‹é—´ç½‘ç»œæ•…éšœï¼‰ï¼Œåˆ™ä¼šä¸»åŠ¨å‘èµ·é€‰ä¸¾ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¢åŠ èŠ‚ç‚¹æœ¬åœ°çš„ <em>current term</em> ï¼Œåˆ‡æ¢åˆ°candidateçŠ¶æ€</li>
<li>æŠ•è‡ªå·±ä¸€ç¥¨</li>
<li>å¹¶è¡Œç»™å…¶ä»–èŠ‚ç‚¹å‘é€ <em>RequestVote RPCs</em></li>
<li>ç­‰å¾…å…¶ä»–èŠ‚ç‚¹çš„å›å¤</li>
</ul>
<p>â€ƒâ€ƒ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„æ¶ˆæ¯ï¼Œå¯èƒ½å‡ºç°ä¸‰ç§ç»“æœ</p>
<ol>
<li>æ”¶åˆ°majorityçš„æŠ•ç¥¨ï¼ˆå«è‡ªå·±çš„ä¸€ç¥¨ï¼‰ï¼Œåˆ™èµ¢å¾—é€‰ä¸¾ï¼Œæˆä¸ºleader</li>
<li>è¢«å‘ŠçŸ¥åˆ«äººå·²å½“é€‰ï¼Œé‚£ä¹ˆè‡ªè¡Œåˆ‡æ¢åˆ°follower</li>
<li>ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°majorityæŠ•ç¥¨ï¼Œåˆ™ä¿æŒcandidateçŠ¶æ€ï¼Œé‡æ–°å‘å‡ºé€‰ä¸¾</li>
</ol>
<p>â€ƒâ€ƒ ç¬¬ä¸€ç§æƒ…å†µï¼Œèµ¢å¾—äº†é€‰ä¸¾ä¹‹åï¼Œæ–°çš„leaderä¼šç«‹åˆ»ç»™æ‰€æœ‰èŠ‚ç‚¹å‘æ¶ˆæ¯ï¼Œå¹¿è€Œå‘Šä¹‹ï¼Œé¿å…å…¶ä½™èŠ‚ç‚¹è§¦å‘æ–°çš„é€‰ä¸¾ã€‚åœ¨è¿™é‡Œï¼Œå…ˆå›åˆ°æŠ•ç¥¨è€…çš„è§†è§’ï¼ŒæŠ•ç¥¨è€…å¦‚ä½•å†³å®šæ˜¯å¦ç»™ä¸€ä¸ªé€‰ä¸¾è¯·æ±‚æŠ•ç¥¨å‘¢ï¼Œæœ‰ä»¥ä¸‹çº¦æŸï¼š</p>
<ul>
<li>åœ¨ä»»ä¸€ä»»æœŸå†…ï¼Œå•ä¸ªèŠ‚ç‚¹æœ€å¤šåªèƒ½æŠ•ä¸€ç¥¨</li>
<li>å€™é€‰äººçŸ¥é“çš„ä¿¡æ¯ä¸èƒ½æ¯”è‡ªå·±çš„å°‘ï¼ˆè¿™ä¸€éƒ¨åˆ†ï¼Œåé¢ä»‹ç»log replicationå’Œsafetyçš„æ—¶å€™ä¼šè¯¦ç»†ä»‹ç»ï¼‰</li>
<li>first-come-first-served å…ˆæ¥å…ˆå¾—</li>
</ul>
<p>â€ƒâ€ƒ ç¬¬äºŒç§æƒ…å†µï¼Œæ¯”å¦‚æœ‰ä¸‰ä¸ªèŠ‚ç‚¹A B Cã€‚A BåŒæ—¶å‘èµ·é€‰ä¸¾ï¼Œè€ŒAçš„é€‰ä¸¾æ¶ˆæ¯å…ˆåˆ°è¾¾Cï¼ŒCç»™AæŠ•äº†ä¸€ç¥¨ï¼Œå½“Bçš„æ¶ˆæ¯åˆ°è¾¾Cæ—¶ï¼Œå·²ç»ä¸èƒ½æ»¡è¶³ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ä¸ªçº¦æŸï¼Œå³Cä¸ä¼šç»™BæŠ•ç¥¨ï¼Œè€ŒAå’ŒBæ˜¾ç„¶éƒ½ä¸ä¼šç»™å¯¹æ–¹æŠ•ç¥¨ã€‚Aèƒœå‡ºä¹‹åï¼Œä¼šç»™B,Cå‘å¿ƒè·³æ¶ˆæ¯ï¼ŒèŠ‚ç‚¹Bå‘ç°èŠ‚ç‚¹Açš„termä¸ä½äºè‡ªå·±çš„termï¼ŒçŸ¥é“æœ‰å·²ç»æœ‰Leaderäº†ï¼Œäºæ˜¯è½¬æ¢æˆfollowerã€‚</p>
<p>â€ƒâ€ƒ ç¬¬ä¸‰ç§æƒ…å†µï¼Œæ²¡æœ‰ä»»ä½•èŠ‚ç‚¹è·å¾—majorityæŠ•ç¥¨ï¼Œæ¯”å¦‚ä¸‹å›¾è¿™ç§æƒ…å†µï¼š</p>
<p><img src="https://i.postimg.cc/3RGMCShr/Snipaste-2025-10-13-20-38-22.png" alt="image-20251013201444866"></p>
<p>â€ƒâ€ƒ æ€»å…±æœ‰å››ä¸ªèŠ‚ç‚¹ï¼ŒNode Cã€Node DåŒæ—¶æˆä¸ºäº†candidateï¼Œè¿›å…¥äº†term 4ï¼Œä½†Node AæŠ•äº†NodeDä¸€ç¥¨ï¼ŒNodeBæŠ•äº†Node Cä¸€ç¥¨ï¼Œè¿™å°±å‡ºç°äº†å¹³ç¥¨ split voteçš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™å¤§å®¶éƒ½åœ¨ç­‰å•Šç­‰ï¼Œç›´åˆ°è¶…æ—¶åé‡æ–°å‘èµ·é€‰ä¸¾ã€‚å¦‚æœå‡ºç°å¹³ç¥¨çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±å»¶é•¿äº†ç³»ç»Ÿä¸å¯ç”¨çš„æ—¶é—´ï¼ˆæ²¡æœ‰leaderæ˜¯ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯å†™è¯·æ±‚çš„ï¼‰ï¼Œå› æ­¤raftå¼•å…¥äº†randomized election timeoutsæ¥å°½é‡é¿å…å¹³ç¥¨æƒ…å†µã€‚åŒæ—¶ï¼Œleader-based å…±è¯†ç®—æ³•ä¸­ï¼ŒèŠ‚ç‚¹çš„æ•°ç›®éƒ½æ˜¯å¥‡æ•°ä¸ªï¼Œå°½é‡ä¿è¯majorityçš„å‡ºç°ã€‚</p>
<ul>
<li><p>log replication</p>
<p> å½“æœ‰äº†leaderï¼Œç³»ç»Ÿåº”è¯¥è¿›å…¥å¯¹å¤–å·¥ä½œæœŸäº†ã€‚å®¢æˆ·ç«¯çš„ä¸€åˆ‡è¯·æ±‚æ¥å‘é€åˆ°leaderï¼Œleaderæ¥è°ƒåº¦è¿™äº›å¹¶å‘è¯·æ±‚çš„é¡ºåºï¼Œå¹¶ä¸”ä¿è¯leaderä¸followersçŠ¶æ€çš„ä¸€è‡´æ€§ã€‚raftä¸­çš„åšæ³•æ˜¯ï¼Œå°†è¿™äº›è¯·æ±‚ä»¥åŠæ‰§è¡Œé¡ºåºå‘ŠçŸ¥followersã€‚leaderå’Œfollowersä»¥ç›¸åŒçš„é¡ºåºæ¥æ‰§è¡Œè¿™äº›è¯·æ±‚ï¼Œä¿è¯çŠ¶æ€ä¸€è‡´ã€‚</p>
<ul>
<li><h2 id="Replicated-state-machines"><a href="#Replicated-state-machines" class="headerlink" title="Replicated state machines"></a>Replicated state machines</h2></li>
</ul>
<p>â€ƒ å…±è¯†ç®—æ³•çš„å®ç°ä¸€èˆ¬æ˜¯åŸºäºå¤åˆ¶çŠ¶æ€æœºï¼ˆReplicated state machinesï¼‰ï¼Œä½•ä¸ºå¤åˆ¶çŠ¶æ€æœºï¼š</p>
<blockquote>
<p>If two identical, <strong>deterministic</strong> processes begin in the same state and get the same inputs in the same order, they will produce the same output and end in the same state.</p>
</blockquote>
<p>â€ƒâ€ƒ ç®€å•æ¥è¯´ï¼š<strong>ç›¸åŒçš„åˆè¯†çŠ¶æ€ + ç›¸åŒçš„è¾“å…¥ &#x3D; ç›¸åŒçš„ç»“æŸçŠ¶æ€</strong>ã€‚å¼•æ–‡ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„è¯<code>deterministic</code>ï¼Œå°±æ˜¯è¯´ä¸åŒèŠ‚ç‚¹è¦ä»¥ç›¸åŒä¸”ç¡®å®šæ€§çš„å‡½æ•°æ¥å¤„ç†è¾“å…¥ï¼Œè€Œä¸è¦å¼•å…¥ä¸€ä¸‹ä¸ç¡®å®šçš„å€¼ï¼Œæ¯”å¦‚æœ¬åœ°æ—¶é—´ç­‰ã€‚å¦‚ä½•ä¿è¯æ‰€æœ‰èŠ‚ç‚¹ <code>get the same inputs in the same order</code>ï¼Œä½¿ç”¨replicated logæ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„æ³¨æ„ï¼Œlogå…·æœ‰æŒä¹…åŒ–ã€ä¿åºçš„ç‰¹ç‚¹ï¼Œæ˜¯å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³ã€‚</p>
<p>â€ƒâ€ƒå› æ­¤ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œåœ¨raftä¸­ï¼Œleaderå°†å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆcommandï¼‰å°è£…åˆ°ä¸€ä¸ªä¸ªlog entryï¼Œå°†è¿™äº›log entrieså¤åˆ¶ï¼ˆreplicateï¼‰åˆ°æ‰€æœ‰followerèŠ‚ç‚¹ï¼Œç„¶åå¤§å®¶æŒ‰ç›¸åŒé¡ºåºåº”ç”¨ï¼ˆapplyï¼‰log entryä¸­çš„commandï¼Œåˆ™çŠ¶æ€è‚¯å®šæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>â€ƒâ€ƒä¸‹å›¾å½¢è±¡å±•ç¤ºäº†è¿™ç§log-based replicated state machine</p>
<p><img src="https://i.postimg.cc/Xq6R2fNV/Snipaste-2025-10-13-20-38-59.png" alt="image-20251013201616092"></p>
</li>
</ul>
<h3 id="è¯·æ±‚å®Œæ•´æµç¨‹"><a href="#è¯·æ±‚å®Œæ•´æµç¨‹" class="headerlink" title="è¯·æ±‚å®Œæ•´æµç¨‹"></a>è¯·æ±‚å®Œæ•´æµç¨‹</h3><p>â€ƒå½“ç³»ç»Ÿï¼ˆleaderï¼‰æ”¶åˆ°ä¸€ä¸ªæ¥è‡ªå®¢æˆ·ç«¯çš„å†™è¯·æ±‚ï¼Œåˆ°è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ•´ä¸ªè¿‡ç¨‹ä»leaderçš„è§†è§’æ¥çœ‹ä¼šç»å†ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>leader append log entry</li>
<li>leader issue AppendEntries RPC in parallel</li>
<li>leader wait for majority response</li>
<li>leader apply entry to state machine</li>
<li>leader reply to client</li>
<li>leader notify follower apply log</li>
</ul>
<p>â€ƒâ€ƒå¯ä»¥çœ‹åˆ°æ—¥å¿—çš„æäº¤è¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼ä¸¤é˜¶æ®µæäº¤(2PC)ï¼Œä¸è¿‡ä¸2PCçš„åŒºåˆ«åœ¨äºï¼Œleaderåªéœ€è¦å¤§å¤šæ•°ï¼ˆmajorityï¼‰èŠ‚ç‚¹çš„å›å¤å³å¯ï¼Œè¿™æ ·åªè¦è¶…è¿‡ä¸€åŠèŠ‚ç‚¹å¤„äºå·¥ä½œçŠ¶æ€åˆ™ç³»ç»Ÿå°±æ˜¯å¯ç”¨çš„ã€‚</p>
<p>â€ƒâ€ƒé‚£ä¹ˆæ—¥å¿—åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢</p>
<p><img src="https://i.postimg.cc/brf76xYy/Snipaste-2025-10-13-20-39-05.png" alt="image-20251013201659257"></p>
<p>ä¸éš¾çœ‹åˆ°ï¼Œlogsç”±é¡ºåºç¼–å·çš„log entryç»„æˆ ï¼Œæ¯ä¸ªlog entryé™¤äº†åŒ…å«commandï¼Œè¿˜åŒ…å«äº§ç”Ÿè¯¥log entryæ—¶çš„leader termã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œäº”ä¸ªèŠ‚ç‚¹çš„æ—¥å¿—å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œraftç®—æ³•ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œå¹¶ä¸æ˜¯å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œleaderä¼šä¸æ–­å°è¯•ç»™followerå‘log entriesï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„log entrieséƒ½ç›¸åŒã€‚</p>
<p>â€ƒâ€ƒåœ¨ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œleaderåªéœ€è¦æ—¥å¿—è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹å³å¯å‘å®¢æˆ·ç«¯è¿”å›ï¼Œä¸€æ—¦å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸæ¶ˆæ¯ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¿…é¡»ä¿è¯logï¼ˆå…¶å®æ˜¯logæ‰€åŒ…å«çš„commandï¼‰åœ¨ä»»ä½•å¼‚å¸¸çš„æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘ç”Ÿå›æ»šã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªè¯ï¼šcommitï¼ˆcommittedï¼‰ï¼Œapply(applied)ï¼Œå‰è€…æ˜¯æŒ‡æ—¥å¿—è¢«å¤åˆ¶åˆ°äº†å¤§å¤šæ•°èŠ‚ç‚¹åæ—¥å¿—çš„çŠ¶æ€ï¼›è€Œåè€…åˆ™æ˜¯èŠ‚ç‚¹å°†æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºï¼ŒçœŸæ­£å½±å“åˆ°èŠ‚ç‚¹çŠ¶æ€ã€‚</p>
<blockquote>
<p>The leader decides when it is safe to apply a log entry to the state machines; such an entry is called committed. Raft guarantees that committed entries are durable and will eventually be executed by all of the available state machines. A log entry is committed once the leader that created the entry has replicated it on a majority of the servers</p>
</blockquote>
<h2 id="safety"><a href="#safety" class="headerlink" title="safety"></a>safety</h2><p>â€ƒåœ¨ä¸Šé¢æåˆ°åªè¦æ—¥å¿—è¢«å¤åˆ¶åˆ°majorityèŠ‚ç‚¹ï¼Œå°±èƒ½ä¿è¯ä¸ä¼šè¢«å›æ»šï¼Œå³ä½¿åœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ¹leader electionæåˆ°çš„é€‰ä¸¾çº¦æŸæœ‰å…³ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œä¸»è¦è®¨è®ºraftåè®®åœ¨å„ç§å„æ ·çš„å¼‚å¸¸æƒ…å†µä¸‹å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>â€ƒâ€ƒè¡¡é‡ä¸€ä¸ªåˆ†å¸ƒå¼ç®—æ³•ï¼Œæœ‰è®¸å¤šå±æ€§ï¼Œå¦‚</p>
<ul>
<li>safetyï¼šnothing bad happens,</li>
<li>livenessï¼š something good eventually happens.</li>
</ul>
<p>â€ƒâ€ƒåœ¨ä»»ä½•ç³»ç»Ÿæ¨¡å‹ä¸‹ï¼Œéƒ½éœ€è¦æ»¡è¶³safetyå±æ€§ï¼Œå³åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œç³»ç»Ÿéƒ½ä¸èƒ½å‡ºç°ä¸å¯é€†çš„é”™è¯¯ï¼Œä¹Ÿä¸èƒ½å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯çš„å†…å®¹ã€‚æ¯”å¦‚ï¼Œraftä¿è¯è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„æ—¥å¿—ä¸ä¼šè¢«å›æ»šï¼Œé‚£ä¹ˆå°±æ˜¯safetyå±æ€§ã€‚è€Œraftæœ€ç»ˆä¼šè®©æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´ï¼Œè¿™å±äºlivenesså±æ€§ã€‚</p>
<p>â€ƒâ€ƒraftåè®®ä¼šä¿è¯ä»¥ä¸‹å±æ€§</p>
<p><img src="https://i.postimg.cc/5yWhPB99/Snipaste-2025-10-13-20-39-10.png" alt="image-20251013201841886"></p>
<h3 id="Election-safety"><a href="#Election-safety" class="headerlink" title="Election safety"></a>Election safety</h3><p>â€ƒé€‰ä¸¾å®‰å…¨æ€§ï¼Œå³ä»»ä¸€ä»»æœŸå†…æœ€å¤šä¸€ä¸ªleaderè¢«é€‰å‡ºã€‚è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œåœ¨ä¸€ä¸ªå¤åˆ¶é›†ä¸­ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªleaderã€‚ç³»ç»Ÿä¸­åŒæ—¶æœ‰å¤šä½™ä¸€ä¸ªleaderï¼Œè¢«ç§°ä¹‹ä¸ºè„‘è£‚ï¼ˆbrain splitï¼‰ï¼Œè¿™æ˜¯éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œä¼šå¯¼è‡´æ•°æ®çš„è¦†ç›–ä¸¢å¤±ã€‚åœ¨raftä¸­ï¼Œä¸¤ç‚¹ä¿è¯äº†è¿™ä¸ªå±æ€§ï¼š</p>
<ul>
<li>ä¸€ä¸ªèŠ‚ç‚¹æŸä¸€ä»»æœŸå†…æœ€å¤šåªèƒ½æŠ•ä¸€ç¥¨ï¼›</li>
<li>åªæœ‰è·å¾—majorityæŠ•ç¥¨çš„èŠ‚ç‚¹æ‰ä¼šæˆä¸ºleaderã€‚</li>
</ul>
<p>â€ƒâ€ƒå› æ­¤ï¼Œ<strong>æŸä¸€ä»»æœŸå†…ä¸€å®šåªæœ‰ä¸€ä¸ªleader</strong>ã€‚</p>
<h3 id="log-matching"><a href="#log-matching" class="headerlink" title="log matching"></a>log matching</h3><p>â€ƒå¾ˆæœ‰æ„æ€ï¼ŒlogåŒ¹é…ç‰¹æ€§ï¼Œ å°±æ˜¯è¯´å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„æŸä¸ªlog entryçš„log indexç›¸åŒä¸”termç›¸åŒï¼Œé‚£ä¹ˆåœ¨è¯¥indexä¹‹å‰çš„æ‰€æœ‰log entryåº”è¯¥éƒ½æ˜¯ç›¸åŒçš„ã€‚å¦‚ä½•åšåˆ°çš„ï¼Ÿä¾èµ–äºä»¥ä¸‹ä¸¤ç‚¹</p>
<ul>
<li>If two entries in different logs have the same index and term, then they store the same command.</li>
<li>If two entries in different logs have the same index and term, then the logs are identical in all preceding entries.</li>
</ul>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œleaderåœ¨æŸä¸€termçš„ä»»ä¸€ä½ç½®åªä¼šåˆ›å»ºä¸€ä¸ªlog entryï¼Œä¸”log entryæ˜¯append-onlyã€‚å…¶æ¬¡ï¼Œconsistency checkã€‚leaderåœ¨AppendEntriesä¸­åŒ…å«æœ€æ–°log entryä¹‹å‰çš„ä¸€ä¸ªlog çš„termå’Œindexï¼Œå¦‚æœfolloweråœ¨å¯¹åº”çš„term indexæ‰¾ä¸åˆ°æ—¥å¿—ï¼Œé‚£ä¹ˆå°±ä¼šå‘ŠçŸ¥leaderä¸ä¸€è‡´ã€‚</p>
<p>â€ƒâ€ƒåœ¨æ²¡æœ‰å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œlog matchingæ˜¯å¾ˆå®¹æ˜“æ»¡è¶³çš„ï¼Œä½†å¦‚æœå‡ºç°äº†node crashï¼Œæƒ…å†µå°±ä¼šå˜å¾—è´Ÿè´£ã€‚æ¯”å¦‚ä¸‹å›¾</p>
<p><img src="https://i.postimg.cc/NFv3N6GY/Snipaste-2025-10-13-20-39-14.png" alt="image-20251013201956261"></p>
<p>â€ƒ<strong>æ³¨æ„</strong>ï¼šä¸Šå›¾çš„a-fä¸æ˜¯6ä¸ªfollowerï¼Œè€Œæ˜¯æŸä¸ªfollowerå¯èƒ½å­˜åœ¨çš„å…­ä¸ªçŠ¶æ€</p>
<p>â€ƒâ€ƒleaderã€followeréƒ½å¯èƒ½crashï¼Œé‚£ä¹ˆfollowerç»´æŠ¤çš„æ—¥å¿—ä¸leaderç›¸æ¯”å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µ</p>
<ul>
<li>æ¯”leaderæ—¥å¿—å°‘ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ab</li>
<li>æ¯”leaderæ—¥å¿—å¤šï¼Œå¦‚ä¸Šå›¾ä¸­çš„cd</li>
<li>æŸäº›ä½ç½®æ¯”leaderå¤šï¼ŒæŸäº›æ—¥å¿—æ¯”leaderå°‘ï¼Œå¦‚efï¼ˆå¤šå°‘æ˜¯é’ˆå¯¹æŸä¸€ä»»æœŸè€Œè¨€ï¼‰</li>
</ul>
<p>â€ƒâ€ƒå½“å‡ºç°äº†leaderä¸followerä¸ä¸€è‡´çš„æƒ…å†µï¼Œleaderå¼ºåˆ¶followerå¤åˆ¶è‡ªå·±çš„log</p>
<blockquote>
<p>To bring a followerâ€™s log into consistency with its own, the leader must find the latest log entry where the two logs agree, delete any entries in the followerâ€™s log after that point, and send the follower all of the leaderâ€™s entries after that point.</p>
</blockquote>
<p>â€ƒleaderä¼šç»´æŠ¤ä¸€ä¸ªnextIndex[]æ•°ç»„ï¼Œè®°å½•äº†leaderå¯ä»¥å‘é€æ¯ä¸€ä¸ªfollowerçš„log indexï¼Œåˆå§‹åŒ–ä¸ºeaderæœ€åä¸€ä¸ªlog indexåŠ 1ï¼Œ å‰é¢ä¹Ÿæåˆ°ï¼Œleaderé€‰ä¸¾æˆåŠŸä¹‹åä¼šç«‹å³ç»™æ‰€æœ‰followerå‘é€AppendEntries RPCï¼ˆä¸åŒ…å«ä»»ä½•log entryï¼Œ ä¹Ÿå……å½“å¿ƒè·³æ¶ˆæ¯ï¼‰,é‚£ä¹ˆæµç¨‹æ€»ç»“ä¸ºï¼š</p>
<blockquote>
<p>s1 leader åˆå§‹åŒ–nextIndex[x]ä¸º leaderæœ€åä¸€ä¸ªlog index + 1<br>s2 AppendEntriesé‡ŒprevLogTerm prevLogIndexæ¥è‡ª logs[nextIndex[x] - 1]<br>s3 å¦‚æœfolloweråˆ¤æ–­prevLogIndexä½ç½®çš„log termä¸ç­‰äºprevLogTermï¼Œé‚£ä¹ˆè¿”å› Falseï¼Œå¦åˆ™è¿”å›True<br>s4 leaderæ”¶åˆ°followerçš„å›å¤ï¼Œå¦‚æœè¿”å›å€¼æ˜¯Falseï¼Œåˆ™nextIndex[x] -&#x3D; 1, è·³è½¬åˆ°s2. å¦åˆ™<br>s5 åŒæ­¥nextIndex[x]åçš„æ‰€æœ‰log entries</p>
</blockquote>
<h3 id="leader-completeness-vs-elcetion-restriction"><a href="#leader-completeness-vs-elcetion-restriction" class="headerlink" title="leader completeness vs elcetion restriction"></a>leader completeness vs elcetion restriction</h3><p>â€ƒleaderå®Œæ•´æ€§ï¼šå¦‚æœä¸€ä¸ªlog entryåœ¨æŸä¸ªä»»æœŸè¢«æäº¤ï¼ˆcommittedï¼‰ï¼Œé‚£ä¹ˆè¿™æ¡æ—¥å¿—ä¸€å®šä¼šå‡ºç°åœ¨æ‰€æœ‰æ›´é«˜termçš„leaderçš„æ—¥å¿—é‡Œé¢ã€‚è¿™ä¸ªè·Ÿleader electionã€log replicationéƒ½æœ‰å…³ã€‚</p>
<ul>
<li>ä¸€ä¸ªæ—¥å¿—è¢«å¤åˆ¶åˆ°majorityèŠ‚ç‚¹æ‰ç®—committed</li>
<li>ä¸€ä¸ªèŠ‚ç‚¹å¾—åˆ°majorityçš„æŠ•ç¥¨æ‰èƒ½æˆä¸ºleaderï¼Œè€ŒèŠ‚ç‚¹Aç»™èŠ‚ç‚¹BæŠ•ç¥¨çš„å…¶ä¸­ä¸€ä¸ªå‰ææ˜¯ï¼ŒBçš„æ—¥å¿—ä¸èƒ½æ¯”Açš„æ—¥å¿—æ—§ã€‚ä¸‹é¢çš„å¼•æ–‡æŒ‡å¤„äº†å¦‚ä½•åˆ¤æ–­æ—¥å¿—çš„æ–°æ—§</li>
</ul>
<blockquote>
<p>voter denies its vote if its own log is more up-to-date than that of the candidate.</p>
</blockquote>
<blockquote>
<p>If the logs have last entries with different terms, then the log with the later term is more up-to-date. If the logs end with the same term, then whichever log is longer is more up-to-date.</p>
</blockquote>
<p>ä¸Šé¢ä¸¤ç‚¹éƒ½æåˆ°äº†majorityï¼šcommit majority and vote majorityï¼Œæ ¹æ®Quorumï¼Œè¿™ä¸¤ä¸ªmajorityä¸€å®šæ˜¯æœ‰é‡åˆçš„ï¼Œå› æ­¤è¢«é€‰ä¸¾å‡ºçš„leaderä¸€å®šåŒ…å«äº†æœ€æ–°çš„committedçš„æ—¥å¿—ã€‚</p>
<p>â€ƒâ€ƒraftä¸å…¶ä»–åè®®ï¼ˆViewstamped Replicationã€mongodbï¼‰ä¸åŒï¼Œraftå§‹ç»ˆä¿è¯leadeåŒ…å«æœ€æ–°çš„å·²æäº¤çš„æ—¥å¿—ï¼Œå› æ­¤leaderä¸ä¼šä»follower catchupæ—¥å¿—ï¼Œè¿™ä¹Ÿå¤§å¤§ç®€åŒ–äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p>
<h1 id="corner-case"><a href="#corner-case" class="headerlink" title="corner case"></a>corner case</h1><h2 id="stale-leader"><a href="#stale-leader" class="headerlink" title="stale leader"></a>stale leader</h2><p>raftä¿è¯Election safetyï¼Œå³ä¸€ä¸ªä»»æœŸå†…æœ€å¤šåªæœ‰ä¸€ä¸ªleaderï¼Œä½†åœ¨ç½‘ç»œåˆ†å‰²ï¼ˆnetwork partitionï¼‰çš„æƒ…å†µä¸‹ï¼Œ<strong>å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªleaderï¼Œä½†ä¸¤ä¸ªleaderæ‰€å¤„çš„ä»»æœŸæ˜¯ä¸åŒçš„</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://i.postimg.cc/zvYsdCDB/Snipaste-2025-10-13-20-39-20.png" alt="image-20251013202228103"></p>
<p>â€ƒâ€ƒç³»ç»Ÿæœ‰5ä¸ªèŠ‚ç‚¹ABCDEç»„æˆï¼Œåœ¨term1ï¼ŒNode Bæ˜¯leaderï¼Œä½†Node Aã€Bå’ŒNode Cã€Dã€Eä¹‹é—´å‡ºç°äº†ç½‘ç»œåˆ†å‰²ï¼Œå› æ­¤Node Cã€Dã€Eæ— æ³•æ”¶åˆ°æ¥è‡ªleaderï¼ˆNode Bï¼‰çš„æ¶ˆæ¯ï¼Œåœ¨election timeä¹‹åï¼ŒNode Cã€Dã€Eä¼šåˆ†æœŸé€‰ä¸¾ï¼Œç”±äºæ»¡è¶³majorityæ¡ä»¶ï¼ŒNode Eæˆä¸ºäº†term 2çš„leaderã€‚å› æ­¤ï¼Œåœ¨ç³»ç»Ÿä¸­è²Œä¼¼å‡ºç°äº†ä¸¤ä¸ªleaderï¼šterm 1çš„Node Bï¼Œ term 2çš„Node E, Node Bçš„termæ›´æ—§ï¼Œä½†ç”±äºæ— æ³•ä¸MajorityèŠ‚ç‚¹é€šä¿¡ï¼ŒNodeBä»ç„¶ä¼šè®¤ä¸ºè‡ªå·±æ˜¯leaderã€‚</p>
<p>â€ƒâ€ƒåœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¥è€ƒè™‘è¯»å†™ã€‚</p>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œå¦‚æœå®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€åˆ°äº†NodeBï¼ŒNodeBæ— æ³•å°†log entry å¤åˆ¶åˆ°majorityèŠ‚ç‚¹ï¼Œå› æ­¤ä¸ä¼šå‘Šè¯‰å®¢æˆ·ç«¯å†™å…¥æˆåŠŸï¼Œè¿™å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>
<p>â€ƒâ€ƒå¯¹äºè¯»è¯·æ±‚ï¼Œstale leaderå¯èƒ½è¿”å›stale dataï¼Œæ¯”å¦‚åœ¨read-after-writeçš„ä¸€è‡´æ€§è¦æ±‚ä¸‹ï¼Œå®¢æˆ·ç«¯å†™å…¥åˆ°äº†term2ä»»æœŸçš„leader Node Eï¼Œä½†è¯»è¯·æ±‚å‘é€åˆ°äº†Node Bã€‚å¦‚æœè¦ä¿è¯ä¸è¿”å›stale dataï¼Œleaderéœ€è¦checkè‡ªå·±æ˜¯å¦è¿‡æ—¶äº†ï¼ŒåŠæ³•å°±æ˜¯ä¸å¤§å¤šæ•°èŠ‚ç‚¹é€šä¿¡ä¸€æ¬¡ï¼Œè¿™ä¸ªå¯èƒ½ä¼šå‡ºç°æ•ˆç‡é—®é¢˜ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨leaseï¼Œä½†è¿™å°±ä¼šä¾èµ–ç‰©ç†æ—¶é’Ÿã€‚</p>
<p>â€ƒâ€ƒä»raftçš„è®ºæ–‡ä¸­å¯ä»¥çœ‹åˆ°ï¼Œleaderè½¬æ¢æˆfollowerçš„æ¡ä»¶æ˜¯æ”¶åˆ°æ¥è‡ªæ›´é«˜termçš„æ¶ˆæ¯ï¼Œå¦‚æœç½‘ç»œåˆ†å‰²ä¸€ç›´æŒç»­ï¼Œé‚£ä¹ˆstale leaderå°±ä¼šä¸€ç›´å­˜åœ¨ã€‚è€Œåœ¨raftçš„ä¸€äº›å®ç°æˆ–è€…raft-likeåè®®ä¸­ï¼Œleaderå¦‚æœæ”¶ä¸åˆ°majorityèŠ‚ç‚¹çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯ä»¥è‡ªå·±step downï¼Œè‡ªè¡Œè½¬æ¢åˆ°followerçŠ¶æ€ã€‚</p>
<h2 id="State-Machine-Safety"><a href="#State-Machine-Safety" class="headerlink" title="State Machine Safety"></a>State Machine Safety</h2><p>â€ƒå‰é¢åœ¨ä»‹ç»safetyçš„æ—¶å€™æœ‰ä¸€æ¡å±æ€§æ²¡æœ‰è¯¦ç»†ä»‹ç»ï¼Œé‚£å°±æ˜¯State Machine Safetyï¼š</p>
<blockquote>
<p>State Machine Safety: if a server has applied a log entry at a given index to its state machine, no other server will ever apply a different log entry for the same index.</p>
</blockquote>
<p>â€ƒå¦‚æœèŠ‚ç‚¹å°†æŸä¸€ä½ç½®çš„log entryåº”ç”¨åˆ°äº†çŠ¶æ€æœºï¼Œé‚£ä¹ˆå…¶ä»–èŠ‚ç‚¹åœ¨åŒä¸€ä½ç½®ä¸èƒ½åº”ç”¨ä¸åŒçš„æ—¥å¿—ã€‚ç®€å•ç‚¹æ¥è¯´ï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€ä½ç½®ï¼ˆindex in log entriesï¼‰åº”è¯¥åº”ç”¨åŒæ ·çš„æ—¥å¿—ã€‚ä½†æ˜¯ä¼¼ä¹æœ‰æŸäº›æƒ…å†µä¼šè¿èƒŒè¿™ä¸ªåŸåˆ™ï¼š</p>
<p><img src="https://i.postimg.cc/vTwJPr81/Snipaste-2025-10-13-20-39-24.png" alt="image-20251013202350901"></p>
<p>ä¸Šå›¾æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„æƒ…å†µã€‚åœ¨æ—¶åˆ»(a), s1æ˜¯leaderï¼Œåœ¨term2æäº¤çš„æ—¥å¿—åªèµ‹å€¼åˆ°äº†s1 s2ä¸¤ä¸ªèŠ‚ç‚¹å°±crashäº†ã€‚åœ¨æ—¶åˆ»ï¼ˆb), s5æˆä¸ºäº†term 3çš„leaderï¼Œæ—¥å¿—åªèµ‹å€¼åˆ°äº†s5ï¼Œç„¶åcrashã€‚ç„¶ååœ¨(c)æ—¶åˆ»ï¼Œs1åˆæˆä¸ºäº†term 4çš„leaderï¼Œå¼€å§‹èµ‹å€¼æ—¥å¿—ï¼Œäºæ˜¯æŠŠterm2çš„æ—¥å¿—å¤åˆ¶åˆ°äº†s3ï¼Œæ­¤åˆ»ï¼Œå¯ä»¥çœ‹å‡ºterm2å¯¹åº”çš„æ—¥å¿—å·²ç»è¢«å¤åˆ¶åˆ°äº†majorityï¼Œå› æ­¤æ˜¯committedï¼Œå¯ä»¥è¢«çŠ¶æ€æœºåº”ç”¨ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ¥ä¸‹æ¥ï¼ˆdï¼‰æ—¶åˆ»ï¼Œs1åˆcrashäº†ï¼Œs5é‡æ–°å½“é€‰ï¼Œç„¶åå°†term3çš„æ—¥å¿—å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿™å°±å‡ºç°äº†ä¸€ç§å¥‡æ€ªçš„ç°è±¡ï¼šè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ï¼ˆæˆ–è€…è¯´å¯èƒ½å·²ç»åº”ç”¨ï¼‰çš„æ—¥å¿—è¢«å›æ»šã€‚</p>
<p>â€ƒâ€ƒç©¶å…¶æ ¹æœ¬ï¼Œæ˜¯å› ä¸ºterm4æ—¶çš„leader s1åœ¨ï¼ˆCï¼‰æ—¶åˆ»æäº¤äº†ä¹‹å‰term2ä»»æœŸçš„æ—¥å¿—ã€‚ä¸ºäº†æœç»è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼š</p>
<blockquote>
<p><strong>Raft never commits log entries from previous terms by counting replicas</strong>.<br>Only log entries from the leaderâ€™s current term are committed by counting replicas; once an entry from the current term has been committed in this way, then all prior entries are committed indirectly because of the Log Matching Property.</p>
</blockquote>
<p>â€ƒä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸ªleaderé€‰ä¸¾æˆåŠŸä¹‹åï¼Œä¸ä¼šç›´æ¥æäº¤å‰ä»»leaderæ—¶æœŸçš„æ—¥å¿—ï¼Œè€Œæ˜¯é€šè¿‡æäº¤å½“å‰ä»»æœŸçš„æ—¥å¿—çš„æ—¶å€™â€œé¡ºæ‰‹â€æŠŠä¹‹å‰çš„æ—¥å¿—ä¹Ÿæäº¤äº†ï¼Œå…·ä½“æ€ä¹ˆå®ç°äº†ï¼Œåœ¨log matchingéƒ¨åˆ†æœ‰è¯¦ç»†ä»‹ç»ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœleaderè¢«é€‰ä¸¾åæ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚å‘¢ï¼Œè®ºæ–‡ä¸­æœ‰æåˆ°ï¼Œåœ¨ä»»æœŸå¼€å§‹çš„æ—¶å€™å‘ç«‹å³å°è¯•å¤åˆ¶ã€æäº¤ä¸€æ¡ç©ºçš„log</p>
<blockquote>
<p>Raft handles this by having each leader commit a blank no-op entry into the log at the start of its term.</p>
</blockquote>
<p>å› æ­¤ï¼Œåœ¨ä¸Šå›¾ä¸­ï¼Œä¸ä¼šå‡ºç°ï¼ˆCï¼‰æ—¶åˆ»çš„æƒ…å†µï¼Œå³term4ä»»æœŸçš„leader s1ä¸ä¼šå¤åˆ¶term2çš„æ—¥å¿—åˆ°s3ã€‚è€Œæ˜¯å¦‚åŒ(e)æè¿°çš„æƒ…å†µï¼Œé€šè¿‡å¤åˆ¶-æäº¤ term4çš„æ—¥å¿—é¡ºä¾¿æäº¤term2çš„æ—¥å¿—ã€‚å¦‚æœterm4çš„æ—¥å¿—æäº¤æˆåŠŸï¼Œé‚£ä¹ˆterm2çš„æ—¥å¿—ä¹Ÿä¸€å®šæäº¤æˆåŠŸï¼Œæ­¤æ—¶å³ä½¿s1crashï¼Œs5ä¹Ÿä¸ä¼šé‡æ–°å½“é€‰ã€‚</p>
<h2 id="leader-crash"><a href="#leader-crash" class="headerlink" title="leader crash"></a>leader crash</h2><p>followerçš„crashå¤„ç†æ–¹å¼ç›¸å¯¹ç®€å•ï¼Œleaderåªè¦ä¸åœçš„ç»™followerå‘æ¶ˆæ¯å³å¯ã€‚å½“leader crashçš„æ—¶å€™ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—å¤æ‚ã€‚åœ¨<a target="_blank" rel="noopener" href="http://www.cnblogs.com/mindwind/p/5231986.html">è¿™ç¯‡æ–‡ç« </a>ä¸­ï¼Œä½œè€…å°±ç»™å‡ºäº†ä¸€ä¸ªæ›´æ–°è¯·æ±‚çš„æµç¨‹å›¾ã€‚</p>
<p><img src="https://i.postimg.cc/brf76xYk/Snipaste-2025-10-13-20-39-28.png" alt="image-20251013202517110"></p>
<p>æˆ‘ä»¬å¯ä»¥åˆ†æleaderåœ¨ä»»æ„æ—¶åˆ»crashçš„æƒ…å†µï¼Œæœ‰åŠ©äºç†è§£raftç®—æ³•çš„å®¹é”™æ€§ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>raftå°†å…±è¯†é—®é¢˜åˆ†è§£æˆä¸¤ä¸ªç›¸å¯¹ç‹¬ç«‹çš„é—®é¢˜ï¼Œleader electionï¼Œlog replicationã€‚æµç¨‹æ˜¯å…ˆé€‰ä¸¾å‡ºleaderï¼Œç„¶åleaderè´Ÿè´£å¤åˆ¶ã€æäº¤logï¼ˆlogä¸­åŒ…å«commandï¼‰</p>
<p>â€ƒâ€ƒä¸ºäº†åœ¨ä»»ä½•å¼‚å¸¸æƒ…å†µä¸‹ç³»ç»Ÿä¸å‡ºé”™ï¼Œå³æ»¡è¶³safetyå±æ€§ï¼Œå¯¹leader electionï¼Œlog replicationä¸¤ä¸ªå­é—®é¢˜æœ‰è¯¸å¤šçº¦æŸ</p>
<p>leader electionçº¦æŸï¼š</p>
<ul>
<li>åŒä¸€ä»»æœŸå†…æœ€å¤šåªèƒ½æŠ•ä¸€ç¥¨ï¼Œå…ˆæ¥å…ˆå¾—</li>
<li>é€‰ä¸¾äººå¿…é¡»æ¯”è‡ªå·±çŸ¥é“çš„æ›´å¤šï¼ˆæ¯”è¾ƒtermï¼Œlog indexï¼‰</li>
</ul>
<p>log replicationçº¦æŸï¼š</p>
<ul>
<li>ä¸€ä¸ªlogè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œå°±æ˜¯committedï¼Œä¿è¯ä¸ä¼šå›æ»š</li>
<li>leaderä¸€å®šåŒ…å«æœ€æ–°çš„committed logï¼Œå› æ­¤leaderåªä¼šè¿½åŠ æ—¥å¿—ï¼Œä¸ä¼šåˆ é™¤è¦†ç›–æ—¥å¿—</li>
<li>ä¸åŒèŠ‚ç‚¹ï¼ŒæŸä¸ªä½ç½®ä¸Šæ—¥å¿—ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ä¸€å®šæ˜¯ç›¸åŒçš„</li>
<li>Raft never commits log entries from previous terms by counting replicas.</li>
</ul>
<p>â€ƒâ€ƒæœ¬æ–‡æ˜¯åœ¨çœ‹å®Œraftè®ºæ–‡åè‡ªå·±çš„æ€»ç»“ï¼Œä¸ä¸€å®šå…¨é¢ã€‚ä¸ªäººè§‰å¾—ï¼Œå¦‚æœåªæ˜¯ç›¸å¯¹raftåè®®æœ‰ä¸€ä¸ªç®€å•äº†è§£ï¼Œçœ‹è¿™ä¸ª<a target="_blank" rel="noopener" href="http://thesecretlivesofdata.com/raft/">åŠ¨ç”»æ¼”ç¤º</a>å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£ï¼Œè¿˜æ˜¯è¦çœ‹è®ºæ–‡ï¼Œè®ºæ–‡ä¸­Figure 2å¯¹raftç®—æ³•è¿›è¡Œäº†æ¦‚æ‹¬ã€‚æœ€åï¼Œè¿˜æ˜¯æ‰¾ä¸€ä¸ªå®ç°äº†raftç®—æ³•çš„ç³»ç»Ÿæ¥çœ‹çœ‹æ›´å¥½ã€‚</p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><p><a target="_blank" rel="noopener" href="https://web.stanford.edu/~ouster/cgi-bin/papers/raft-atc14">https://web.stanford.edu/~ouster/cgi-bin/papers/raft-atc14</a><br><a target="_blank" rel="noopener" href="https://raft.github.io/">https://raft.github.io/</a><br><a target="_blank" rel="noopener" href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></p>
<hr>
<ul>
<li><strong>æœ¬æ–‡ä½œè€…ï¼š</strong> zhengyun Li</li>
<li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"># åˆ†å¸ƒå¼</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/10/20/%E7%BA%A6%E7%91%9F%E5%A4%AB%E7%8E%AF/" rel="prev" title="çº¦ç‘Ÿå¤«ç¯é—®é¢˜">
      <i class="fa fa-chevron-left"></i> çº¦ç‘Ÿå¤«ç¯é—®é¢˜
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/10/23/Alluxio/" rel="next" title="Alluxio">
      Alluxio <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC82MDkyNS8zNzM5NQ=="></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#raft%E7%AE%97%E6%B3%95%E6%A6%82%E8%A7%88"><span class="nav-number">1.</span> <span class="nav-text">raftç®—æ³•æ¦‚è§ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#leader-election"><span class="nav-number">2.</span> <span class="nav-text">leader election</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%89%E4%B8%BE%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">é€‰ä¸¾è¿‡ç¨‹è¯¦è§£</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Replicated-state-machines"><span class="nav-number">4.</span> <span class="nav-text">Replicated state machines</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B"><span class="nav-number">4.1.</span> <span class="nav-text">è¯·æ±‚å®Œæ•´æµç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#safety"><span class="nav-number">5.</span> <span class="nav-text">safety</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Election-safety"><span class="nav-number">5.1.</span> <span class="nav-text">Election safety</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#log-matching"><span class="nav-number">5.2.</span> <span class="nav-text">log matching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#leader-completeness-vs-elcetion-restriction"><span class="nav-number">5.3.</span> <span class="nav-text">leader completeness vs elcetion restriction</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#corner-case"><span class="nav-number"></span> <span class="nav-text">corner case</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#stale-leader"><span class="nav-number">1.</span> <span class="nav-text">stale leader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#State-Machine-Safety"><span class="nav-number">2.</span> <span class="nav-text">State Machine Safety</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#leader-crash"><span class="nav-number">3.</span> <span class="nav-text">leader crash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#references"><span class="nav-number">5.</span> <span class="nav-text">references</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lzy"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">lzy</p>
  <div class="site-description" itemprop="description">é€‰æ‹©æœ‰æ—¶å€™æ¯”åŠªåŠ›æ›´é‡è¦</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hoshilzy1026" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;hoshilzy1026" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:18338064521@163.com" title="E-Mail â†’ mailto:18338064521@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/6888391895" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;6888391895" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/31529112/ffhoshi" title="StackOverflow â†’ https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;31529112&#x2F;ffhoshi" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



      </div>
<!-- ğŸµ ä½¿ç”¨ APlayer + Meting æ’­æ”¾ç½‘æ˜“äº‘æ­Œå• -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

<!-- ç½‘æ˜“äº‘æ­Œå•æ’­æ”¾å™¨ -->
<meting-js
  server="netease"
  type="playlist"
  id="2259365792"
  fixed="true"
  autoplay="false"
  theme="#ad7a86">
</meting-js>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-12 â€“ 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lzy</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">42k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">2:34</span>
</div>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv">æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº</span>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>

</body>
</html>
